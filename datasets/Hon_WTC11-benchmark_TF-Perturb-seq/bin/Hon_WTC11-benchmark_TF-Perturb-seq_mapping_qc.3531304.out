=============================================
 Running TF Perturb-seq QC Pipeline
 SAMPLE: Hon_WTC11-benchmark_TF-Perturb-seq
 OUTDIR: /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05
=============================================
---- [1/3] Running mapping_qc.py ----
2026-01-06 09:40:26,503 - __main__ - INFO - Loading MuData from /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/1_CRISPR_pipeline/2026_01_05/inference_mudata.h5mu
/cellar/users/aklie/opt/miniconda3/envs/scverse-lite-py311/lib/python3.11/site-packages/mudata/_core/mudata.py:1598: FutureWarning: From 0.4 .update() will not pull obs/var columns from individual modalities by default anymore. Set mudata.set_options(pull_on_update=False) to adopt the new behaviour, which will become the default. Use new pull_obs/pull_var and push_obs/push_var methods for more flexibility.
  self._update_attr("var", axis=0, join_common=join_common)
/cellar/users/aklie/opt/miniconda3/envs/scverse-lite-py311/lib/python3.11/site-packages/mudata/_core/mudata.py:1461: FutureWarning: From 0.4 .update() will not pull obs/var columns from individual modalities by default anymore. Set mudata.set_options(pull_on_update=False) to adopt the new behaviour, which will become the default. Use new pull_obs/pull_var and push_obs/push_var methods for more flexibility.
  self._update_attr("obs", axis=1, join_common=join_common)
2026-01-06 09:40:39,628 - utils - INFO - MuData: 92553 cells total, modalities=['gene', 'guide', 'hashing']
2026-01-06 09:40:39,628 - utils - INFO -   Modality 'gene': 92553 cells, 9395 features
2026-01-06 09:40:39,628 - utils - INFO -   Modality 'guide': 92553 cells, 416 features
2026-01-06 09:40:39,628 - utils - INFO -   Modality 'hashing': 92553 cells, 12 features
2026-01-06 09:40:39,628 - utils - INFO - Adding sample name 'Hon_WTC11-benchmark_TF-Perturb-seq' to barcodes
2026-01-06 09:40:39,628 - utils - INFO -   Example before: GATGAAATCAGCTCGG_0
2026-01-06 09:40:39,633 - utils - INFO -   Example after:  Hon_WTC11-benchmark_TF-Perturb-seq#GATGAAATCAGCTCGG_0
2026-01-06 09:40:39,640 - utils - INFO - Guide modality: computed n_guides_per_cell (obs) and n_cells_per_guide (var) from layer 'guide_assignment'
2026-01-06 09:40:39,642 - __main__ - INFO - Running pre-filter QC
2026-01-06 09:40:40,301 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/pre_filter_gene_knee_plot.png
2026-01-06 09:40:40,301 - utils - INFO - Gene knee plot (UMIs per cell) - min count: 526, max count: 19319
2026-01-06 09:40:41,250 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/pre_filter_gene_qc_histograms_by_batch.png
2026-01-06 09:40:41,520 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/pre_filter_cells_per_batch.png
2026-01-06 09:40:42,073 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/pre_filter_guide_knee_plot.png
2026-01-06 09:40:42,073 - utils - INFO - Guide knee plot (guide UMIs per cell) - min count: 1, max count: 8285
2026-01-06 09:40:42,922 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/pre_filter_guide_qc.png
2026-01-06 09:40:43,480 - __main__ - INFO - Applying joint filters (gene + guide)
2026-01-06 09:40:43,483 - utils - INFO - Cells before filtering: 92553
2026-01-06 09:40:43,483 - utils - INFO - Cells after filtering:  92553
2026-01-06 09:40:44,004 - __main__ - INFO - Running post-filter QC
2026-01-06 09:40:44,642 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/post_filter_gene_knee_plot.png
2026-01-06 09:40:44,642 - utils - INFO - Gene knee plot (UMIs per cell, filtered) - min count: 526, max count: 19319
2026-01-06 09:40:45,584 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/post_filter_gene_qc_histograms_by_batch.png
2026-01-06 09:40:45,853 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/post_filter_cells_per_batch.png
2026-01-06 09:40:46,408 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/post_filter_guide_knee_plot.png
2026-01-06 09:40:46,409 - utils - INFO - Guide knee plot (guide UMIs per cell, filtered) - min count: 1, max count: 8285
2026-01-06 09:40:47,318 - utils - INFO - Saved /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/post_filter_guide_qc.png
2026-01-06 09:40:47,888 - __main__ - INFO - Wrote combined metrics TSV to: /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/qc_metrics.tsv
2026-01-06 09:40:47,888 - __main__ - INFO - Writing filtered gene AnnData to /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/gene.filtered.h5ad
2026-01-06 09:40:50,492 - __main__ - INFO - Writing filtered guide AnnData to /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/guide.filtered.h5ad
2026-01-06 09:40:50,708 - __main__ - INFO - QC script finished.
QC complete → /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/mapping_qc/gene.filtered.h5ad

---- [2/3] Running preprocess.py ----
Preprocessing complete → /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/preprocess/gene.preprocessed.h5ad

---- [3/3] Running cluster.py ----
Clustering complete → /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05/clustering/gene.clustered.h5ad

=============================================
  Pipeline finished for sample: Hon_WTC11-benchmark_TF-Perturb-seq
  Outputs written to: /cellar/users/aklie/data/datasets/tf_perturb_seq/datasets/Hon_WTC11-benchmark_TF-Perturb-seq/results/2_qc/2026_01_05
=============================================
